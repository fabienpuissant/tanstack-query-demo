<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TanStack Query avec React</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #ffffff;
      color: #333;
      line-height: 1.6;
    }

    .presentation {
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }

    .slide {
      display: none;
      flex: 1;
      padding: 40px 60px;
      justify-content: flex-start;
      align-items: flex-start;
      flex-direction: column;
      background: white;
      border: 1px solid #e1e5e9;
      margin: 40px auto;
      border-radius: 12px;
      box-shadow: 0 4px 14px rgba(0, 0, 0, 0.1);
      max-height: calc(100vh - 120px);
      width: 80vw;
      overflow-y: auto;
    }

    .slide.active {
      display: flex;
      animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .slide-center {
      align-items: center;
      text-align: center;
    }

    h1 {
      font-size: 3rem;
      margin-bottom: 20px;
      color: #2563eb;
      font-weight: 700;
    }

    h2 {
      font-size: 2.3rem;
      margin: 20px 0 25px;
      color: #1f2937;
      font-weight: 600;
      border-bottom: 3px solid #2563eb;
      padding-bottom: 8px;
    }

    h3 {
      font-size: 1.5rem;
      margin-bottom: 15px;
      color: #2563eb;
      font-weight: 600;
    }

    p {
      font-size: 1.2rem;
      margin-bottom: 20px;
      color: #4b5563;
    }

    .subtitle {
      font-size: 1.3rem;
      color: #6b7280;
      margin-bottom: 40px;
      font-style: italic;
    }

    ul {
      margin-left: 0;
      padding-left: 0;
    }

    li {
      font-size: 1.1rem;
      margin-bottom: 12px;
      list-style: none;
      position: relative;
      padding-left: 25px;
      color: #374151;
    }

    li::before {
      content: "‚Ä¢";
      position: absolute;
      left: 0;
      color: #2563eb;
      font-weight: bold;
      font-size: 1.2rem;
    }

    .code-container {
      width: 100%;
      margin: 25px 0;
      position: relative;
    }

    .code-header {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-bottom: none;
      padding: 12px 20px;
      font-size: 0.9rem;
      color: #64748b;
      border-radius: 8px 8px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .code-link {
      background: #2563eb;
      color: white;
      text-decoration: none;
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 0.8rem;
      transition: background 0.2s;
    }

    .code-link:hover {
      background: #1d4ed8;
    }

    pre {
      margin: 0 !important;
      border-radius: 0 0 8px 8px !important;
      border: 1px solid #e2e8f0 !important;
      border-top: none !important;
      font-size: 0.95rem !important;
      line-height: 1.5 !important;
      overflow-x: auto;
      background: #f8fafc !important;
    }

    code {
      font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace !important;
    }

    .navigation {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 15px;
      background: white;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      border: 1px solid #e1e5e9;
    }

    .nav-btn {
      padding: 10px 20px;
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      color: #374151;
      cursor: pointer;
      font-size: 0.95rem;
      transition: all 0.2s ease;
    }

    .nav-btn:hover:not(:disabled) {
      background: #2563eb;
      color: white;
      border-color: #2563eb;
    }

    .nav-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .slide-counter {
      position: fixed;
      top: 20px;
      right: 20px;
      background: white;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 0.9rem;
      color: #6b7280;
      border: 1px solid #e1e5e9;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      width: 100%;
      margin-top: 30px;
    }

    .feature-card {
      background: #f8fafc;
      padding: 25px;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      transition: all 0.2s ease;
    }

    .feature-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .feature-card h3 {
      color: #1f2937;
      margin-bottom: 10px;
    }

    .feature-card p {
      color: #6b7280;
      font-size: 1rem;
      margin: 0;
    }

    .highlight {
      background: #fef3c7;
      padding: 2px 6px;
      border-radius: 4px;
      color: #92400e;
      font-weight: 600;
    }

    .emoji {
      font-size: 1.2em;
      margin-right: 8px;
    }

    .config-note {
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      border-radius: 6px;
      padding: 15px;
      margin: 20px 0;
      font-size: 0.95rem;
      color: #1e40af;
    }

    .slide-content {
      width: 100%;
      max-width: 1000px;
    }
  </style>
</head>
<body>
<div class="presentation">
  <div class="slide-counter">
    <span id="current-slide">1</span> / <span id="total-slides">12</span>
  </div>

  <!-- Slide 1: Titre -->
  <div class="slide active slide-center">
    <div class="slide-content">
      <h1>TanStack Query avec React</h1>
      <p class="subtitle">Gestion moderne des donn√©es asynchrones</p>
      <p>D√©monstration avec une application TodoList</p>
    </div>
  </div>

  <!-- Slide 2: Qu'est-ce que TanStack Query ? -->
  <div class="slide">
    <div class="slide-content">
      <h2>Qu'est-ce que TanStack Query ?</h2>
      <ul>
        <li>Anciennement <span class="highlight">React Query</span> - rebaptis√© pour supporter d'autres frameworks</li>
        <li>Librairie de <span class="highlight">gestion d'√©tat serveur</span> pour React</li>
        <li>Simplifie les appels API et la synchronisation des donn√©es</li>
        <li>Cache intelligent et automatique des r√©ponses</li>
        <li>Gestion avanc√©e des erreurs et strat√©gies de retry</li>
        <li>Optimisations de performance (background updates, stale-while-revalidate)</li>
        <li>DevTools int√©gr√©s pour le debugging</li>
      </ul>
    </div>
  </div>

  <!-- Slide 3: Notre projet - TodoList -->
  <div class="slide">
    <div class="slide-content">
      <h2><span class="emoji">üìã</span>Notre projet : TodoList</h2>
      <p class="subtitle">Une application simple pour d√©montrer les concepts cl√©s</p>
      <div class="feature-grid">
        <div class="feature-card">
          <h3><span class="emoji">üìÑ</span>Lister les t√¢ches</h3>
          <p>useQuery pour r√©cup√©rer et cacher les todos</p>
        </div>
        <div class="feature-card">
          <h3><span class="emoji">‚ûï</span>Ajouter une t√¢che</h3>
          <p>useMutation pour cr√©er de nouveaux todos</p>
        </div>
        <div class="feature-card">
          <h3><span class="emoji">‚úÖ</span>Marquer termin√©e</h3>
          <p>useMutation pour modifier le statut</p>
        </div>
        <div class="feature-card">
          <h3><span class="emoji">üóëÔ∏è</span>Supprimer</h3>
          <p>useMutation pour effacer des todos</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Slide 4: Les Queries -->
  <div class="slide">
    <div class="slide-content">
      <h2><span class="emoji">üîç</span>Les Queries</h2>
      <p>Pour r√©cup√©rer et mettre en cache les donn√©es du serveur</p>

      <div class="code-container">
        <div class="code-header">
          <span>TodosProvider.tsx</span>
        </div>
        <pre><code class="language-javascript">const {
  data: todos,
  isLoading,
  error,
  refetch,
  isFetching
} = useQuery({
  queryKey: ['todos'],
  queryFn: () => repository.getTodos()
})</code></pre>
      </div>

      <ul>
        <li><span class="highlight">queryKey</span> : identifiant unique pour le cache</li>
        <li><span class="highlight">queryFn</span> : fonction asynchrone qui r√©cup√®re les donn√©es</li>
        <li><span class="highlight">staleTime</span> : dur√©e avant que les donn√©es soient consid√©r√©es comme obsol√®tes</li>
        <li>√âtats automatiques : loading, error, success</li>
      </ul>
    </div>
  </div>

  <!-- Slide 5: Les Mutations -->
  <div class="slide">
    <div class="slide-content">
      <h2><span class="emoji">‚úèÔ∏è</span>Les Mutations</h2>
      <p>Pour modifier les donn√©es c√¥t√© serveur (POST, PUT, DELETE)</p>

      <div class="code-container">
        <div class="code-header">
          <span>TodosProvider.tsx</span>
        </div>
        <pre><code class="language-javascript">const addTodoMutation = useMutation({
  mutationFn: (todo: Todo) => repository.addTodo(todo),
  onSuccess: () => {
    refreshTodos()
    toast.success('T√¢che ajout√©e !')
  },
  onError: (error) => {
    toast.error("Erreur lors de l'ajout")
  }
})

// Utilisation
const handleSubmit = (todo: Todo) => {
  addTodoMutation.mutate(todo)
}</code></pre>
      </div>

      <ul>
        <li><span class="highlight">mutationFn</span> : fonction qui ex√©cute la mutation</li>
        <li><span class="highlight">onSuccess</span> : callback appel√© en cas de succ√®s</li>
        <li><span class="highlight">onError</span> : gestion des erreurs</li>
        <li>√âtats : isLoading, error, isSuccess</li>
      </ul>
    </div>
  </div>

  <!-- Slide 6: Query Invalidation -->
  <div class="slide">
    <div class="slide-content">
      <h2><span class="emoji">üîÑ</span>Invalidation des Queries</h2>
      <p>Synchroniser automatiquement les donn√©es apr√®s une mutation</p>

      <div class="code-container">
        <pre><code class="language-javascript">// Invalider une query sp√©cifique
queryClient.invalidateQueries(['todos'])

// Invalider plusieurs queries avec un pattern
queryClient.invalidateQueries({ queryKey: ['todos'] })

// Dans une mutation
const deleteTodoMutation = useMutation({
  mutationFn: deleteTodo,
  onSuccess: (deletedTodo) => {
    // Approche 1: Invalidation compl√®te
    queryClient.invalidateQueries(['todos'])

    // Approche 2: Mise √† jour manuelle du cache
    queryClient.setQueryData(['todos'], (oldTodos) =>
      oldTodos.filter(todo => todo.id !== deletedTodo.id)
    )
  }
})</code></pre>
      </div>

      <ul>
        <li><span class="highlight">Synchronisation automatique</span> de toutes les vues</li>
        <li>Refetch intelligent des donn√©es modifi√©es</li>
        <li>Pattern matching pour invalider plusieurs queries</li>
        <li>Mise √† jour manuelle du cache pour √©viter les refetch</li>
      </ul>
    </div>
  </div>

  <!-- Slide 7: Gestion des Retry -->
  <div class="slide">
    <div class="slide-content">
      <h2><span class="emoji">üîÅ</span>Gestion des Retry</h2>
      <p>R√©silience automatique face aux erreurs r√©seau</p>

      <div class="code-container">
        <div class="code-header">
          <span>hooks/useTodosWithRetry.js</span>
          <a href="./src/hooks/useTodosWithRetry.js" class="code-link">Voir le code</a>
        </div>
        <pre><code class="language-javascript">const { data } = useQuery({
  queryKey: ['todos'],
  queryFn: fetchTodos,
  retry: 3,
  retryDelay: (attemptIndex) => {
    // D√©lai exponentiel: 1s, 2s, 4s...
    return Math.min(1000 * 2 ** attemptIndex, 30000)
  },
  retryOnMount: true,
})

          const { data } = useQuery({
  queryKey: ['todos'],
  queryFn: fetchTodos,
  retry: (failureCount, error) => {
    if (error.status === 404 || error.status === 403) {
      return false
    }
    // Retry maximum 3 fois pour les autres erreurs
    return failureCount < 3
  }
})

// Pour les mutations aussi
const mutation = useMutation({
  mutationFn: createTodo,
  retry: 2,
  retryDelay: 1000
})</code></pre>
      </div>

      <ul>
        <li><span class="highlight">Retry automatique</span> configurable par query</li>
        <li><span class="highlight">D√©lai exponentiel</span> pour √©viter la surcharge serveur</li>
        <li><span class="highlight">Conditions personnalis√©es</span> selon le type d'erreur</li>
        <li>Applicable aux queries ET aux mutations</li>
      </ul>
    </div>
  </div>

  <!-- Slide 8: Optimistic Updates -->
  <div class="slide">
    <div class="slide-content">
      <h2><span class="emoji">‚ö°</span>Optimistic Updates</h2>
      <p>Mise √† jour imm√©diate de l'UI pour une meilleure exp√©rience utilisateur</p>

      <div class="code-container">
        <div class="code-header">
          <span>hooks/useOptimisticTodos.js</span>
          <a href="./src/hooks/useOptimisticTodos.js" class="code-link">Voir le code</a>
        </div>
        <pre><code class="language-javascript">const toggleTodoMutation = useMutation({
  mutationFn: (updatedTodo) =>
    fetch(`/api/todos/${updatedTodo.id}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(updatedTodo)
    }),

  onMutate: async (updatedTodo) => {
    // 1. Annuler tous les refetch en cours pour √©viter les conflits
    await queryClient.cancelQueries(['todos'])

    // 2. Sauvegarder l'√©tat actuel pour pouvoir revenir en arri√®re
    const previousTodos = queryClient.getQueryData(['todos'])

    // 3. Mise √† jour optimiste du cache
    queryClient.setQueryData(['todos'], (oldTodos) =>
      oldTodos.map(todo =>
        todo.id === updatedTodo.id
          ? { ...todo, completed: updatedTodo.completed }
          : todo
      )
    )

    // Retourner le context pour onError
    return { previousTodos }
  },

  onError: (error, updatedTodo, context) => {
    // Rollback en cas d'erreur
    if (context?.previousTodos) {
      queryClient.setQueryData(['todos'], context.previousTodos)
    }
    toast.error('Erreur lors de la mise √† jour')
  },

  onSuccess: () => {
    // Optionnel: invalider pour √™tre s√ªr d'avoir les donn√©es √† jour
    queryClient.invalidateQueries(['todos'])
  }
})</code></pre>
      </div>
    </div>
  </div>

  <!-- Slide 9: √âtats de chargement -->
  <div class="slide">
    <div class="slide-content">
      <h2><span class="emoji">üìä</span>√âtats de chargement et d'erreur</h2>

      <div class="feature-grid">
        <div class="feature-card">
          <h3>isLoading</h3>
          <p>Premier chargement, aucune donn√©e en cache</p>
        </div>
        <div class="feature-card">
          <h3>isFetching</h3>
          <p>Refetch en arri√®re-plan (donn√©es d√©j√† en cache)</p>
        </div>
        <div class="feature-card">
          <h3>isStale</h3>
          <p>Donn√©es consid√©r√©es comme obsol√®tes</p>
        </div>
        <div class="feature-card">
          <h3>isError</h3>
          <p>Erreur lors de la r√©cup√©ration des donn√©es</p>
        </div>
      </div>

      <div class="code-container">
        <div class="code-header">
          <span>components/TodoList.jsx</span>
        </div>
        <pre><code class="language-javascript">function TodoList() {
  const {
    data: todos,
    isLoading,
    isFetching,
    error,
    refetch
  } = useQuery({
    queryKey: ['todos'],
    queryFn: fetchTodos
  })

  if (isLoading) {
    return &lt;div className=&quot;spinner&quot;&gt;Chargement initial...&lt;/div&gt;
  }

  if (error) {
    return (
      &lt;div className=&quot;error&quot;&gt;
        &lt;p&gt;Erreur: {error.message}&lt;/p&gt;
        &lt;button onClick={() =&gt; refetch()}&gt;R√©essayer&lt;/button&gt;
      &lt;/div&gt;
    )
  }

  return (
    &lt;div&gt;
      {isFetching &amp;&amp; &lt;div className=&quot;fetching&quot;&gt;Mise √† jour...&lt;/div&gt;}
      &lt;ul&gt;
        {todos?.map(todo =&gt; (
          &lt;TodoItem key={todo.id} todo={todo} /&gt;
        ))}
      &lt;/ul&gt;
    &lt;/div&gt;
  )
}
</code></pre>
      </div>
    </div>
  </div>

  <!-- Slide 10: Configuration globale -->
  <div class="slide">
    <div class="slide-content">
      <h2><span class="emoji">‚öôÔ∏è</span>Configuration globale</h2>

      <div class="code-container">
        <div class="code-header">
          <a href="./src/queryClient.js" class="code-link">Voir le code</a>
        </div>
        <pre><code class="language-javascript">import { QueryClient, QueryClientProvider } from '@tanstack/react-query'

const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      // Donn√©es consid√©r√©es fra√Æches pendant 5 minutes
      staleTime: 1000 * 60 * 5,
      // Gard√©es en cache pendant 30 minutes
      cacheTime: 1000 * 60 * 30,
      // 2 tentatives en cas d'erreur
      retry: 2,
      // Ne pas refetch lors du focus de la fen√™tre
      refetchOnWindowFocus: false,
      // Refetch lors de la reconnexion
      refetchOnReconnect: true
    },
    mutations: {
      // 1 retry pour les mutations
      retry: 1
    }
  }
})

function App() {
  return (
    &lt;QueryClientProvider client={queryClient}&gt;
      &lt;TodoApp /&gt;
    &lt;/QueryClientProvider&gt
  )
}</code></pre>
      </div>

      <div class="config-note">
        <strong>üí° Conseil :</strong> Adaptez staleTime selon la fr√©quence de mise √† jour de vos donn√©es.
        Pour des donn√©es statiques : 30min+. Pour des donn√©es temps r√©el : quelques secondes.
      </div>
    </div>
  </div>

  <!-- Slide 11: DevTools -->
  <div class="slide">
    <div class="slide-content">
      <h2><span class="emoji">üõ†Ô∏è</span>DevTools de d√©veloppement</h2>
      <ul>
        <li><span class="highlight">Inspection en temps r√©el</span> du cache</li>
        <li><span class="highlight">Visualisation</span> de toutes les queries et mutations</li>
        <li><span class="highlight">√âtats d√©taill√©s</span> : loading, error, stale, fresh</li>
        <li><span class="highlight">Chronologie</span> des invalidations et refetch</li>
        <li><span class="highlight">Actions manuelles</span> : refetch, invalidate, remove</li>
        <li>Debugging facilit√© avec donn√©es structur√©es</li>
      </ul>
    </div>
  </div>

  <!-- Slide 12: Avantages et conclusion -->
  <div class="slide slide-center">
    <div class="slide-content">
      <h2><span class="emoji">üéØ</span>Pourquoi TanStack Query ?</h2>

      <div class="feature-grid">
        <div class="feature-card">
          <h3><span class="emoji">üöÄ</span>Performance</h3>
          <p>Cache intelligent, background updates, d√©duplication des requ√™tes</p>
        </div>
        <div class="feature-card">
          <h3><span class="emoji">üîß</span>Developer Experience</h3>
          <p>DevTools int√©gr√©s, TypeScript natif, API intuitive</p>
        </div>
        <div class="feature-card">
          <h3><span class="emoji">üõ°Ô∏è</span>Robustesse</h3>
          <p>Retry automatique, gestion d'erreurs, mode offline</p>
        </div>
        <div class="feature-card">
          <h3><span class="emoji">‚ö°</span>UX</h3>
          <p>Optimistic updates, √©tats de loading pr√©cis</p>
        </div>
      </div>

      <div style="margin-top: 50px; padding: 30px; background: #f0f9ff; border-radius: 8px; border: 1px solid #0ea5e9;">
        <p style="font-size: 1.4rem; font-weight: 600; color: #0c4a6e; margin: 0;">
          üéâ Moins de code boilerplate, plus de fonctionnalit√©s robustes !
        </p>
        <p style="margin-top: 15px; margin-bottom: 0; color: #0369a1;">
          Remplace useState + useEffect + gestion manuelle des erreurs
        </p>
      </div>
    </div>
  </div>

  <div class="navigation">
    <button class="nav-btn" id="prev-btn" onclick="previousSlide()">‚Üê Pr√©c√©dent</button>
    <button class="nav-btn" id="next-btn" onclick="nextSlide()">Suivant ‚Üí</button>
  </div>
</div>

<script>
  let currentSlideIndex = 0;
  const slides = document.querySelectorAll('.slide');
  const totalSlides = slides.length;

  document.getElementById('total-slides').textContent = totalSlides;

  function showSlide(index) {
    slides.forEach(slide => slide.classList.remove('active'));
    slides[index].classList.add('active');

    document.getElementById('current-slide').textContent = index + 1;

    // Update navigation buttons
    document.getElementById('prev-btn').disabled = index === 0;
    document.getElementById('next-btn').disabled = index === totalSlides - 1;

    // Trigger syntax highlighting for the current slide
    Prism.highlightAllUnder(slides[index]);
  }

  function nextSlide() {
    if (currentSlideIndex < totalSlides - 1) {
      currentSlideIndex++;
      showSlide(currentSlideIndex);
    }
  }

  function previousSlide() {
    if (currentSlideIndex > 0) {
      currentSlideIndex--;
      showSlide(currentSlideIndex);
    }
  }

  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowRight' || e.key === ' ') {
      e.preventDefault();
      nextSlide();
    } else if (e.key === 'ArrowLeft') {
      e.preventDefault();
      previousSlide();
    } else if (e.key === 'Home') {
      e.preventDefault();
      currentSlideIndex = 0;
      showSlide(currentSlideIndex);
    } else if (e.key === 'End') {
      e.preventDefault();
      currentSlideIndex = totalSlides - 1;
      showSlide(currentSlideIndex);
    }
  });

  // Initialize
  showSlide(0);
</script>
</body>
</html>
